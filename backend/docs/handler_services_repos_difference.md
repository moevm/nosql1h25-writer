# Чем отличаются обработчики, сервисы и репозитории?
## Обработчик
Содержит:
* первичная валидация запроса, например: данные соответствуют типу, длина строки, какие-то весьма очевидные проверки (здравый смысл: ID или возраст не может быть отрицательным и т.п.);
* вызов методов сервиса;
* обработка ошибок от метода (возврат ответа с нужным кодом в зависимости от ошибки);
* структуры для запроса с установленными тэгами json, example, validate и т.п.;
* структуры для ответа с установленными тэгами json, example.
* документация для Swagger (достаточно подробная);
* возврат ответа;

Не содержит:
* продвинутая валидация (email уже занят, пароль не подходит);
* обращений в репозитории напрямую;
* логирования ошибок;
* общения с внешними сервисами (сделать запрос к другому сайту).

## Сервис
Содержит:
* основная логика приложения;
* вызовы методов репозиториев (можно использовать несколько методов из разных репозиториев);
* продвинутая валидация данных (все логические ограничения, например: нельзя создать чат с самим собой и прочее);
* логирование ошибок;
* интеграция с внешними сервисами.

Не содержит:
* прямых запросов в базу данных;
* прямых HTTP-запросов к внешним сервисам.

## Репозитории
Содержит:
* базовые операции над сущностями (добавить, получить, обновить, удалить);
* некоторые продвинутые операции (обновить или вставить; получить с пагинацией и сортировкой; проверить, что существует).

Не содержит:
* проверки на валидность данных;
* работы с методами других репозиториев;

## Про ошибки
Никогда не стоит возвращать ошибки напрямую обработчику из сервиса, так как можем случайно раскрыть детали реализации и другую чувствительную информацию.
Всегда используйте свои типы ошибок, например:

```go
package users

import "errors"

var (
	ErrCannotGetUser    = errors.New("cannot get user")
	ErrUserNotFound     = errors.New("user not found")
)

func (s *UserService) Get(ctx context.Context, userId int) (entity.User, error) {
	user, err := s.userRepo.GetById(ctx, userId)
	if err != nil {
		if errors.Is(err, usersrepo.ErrNotFound) {
            // логировать эту ошибку не имеет смысла
			return entity.Song{}, ErrUserNotFound // подменили на свою ошибку
		}
		log.Errorf("UserService.Get - s.userRepo.GetById: %v", err) // залогировали истинную причину ошибки
		return entity.User{}, ErrCannotGetUser // вернули свою ошибку, которая не содержит чувствительной информации
	}

	return user, nil
}
```